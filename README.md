# Drone-embryogenesis_ML
Deep learning
# Enhanced Gene Expression Analysis System V3.0
## ç®€ä»‹

Enhanced Gene Expression Analysis System V3.0 æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„åŸºå› è¡¨è¾¾æ•°æ®åˆ†æå·¥å…·ï¼Œæ•´åˆäº†å¤šç§å…ˆè¿›çš„æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ æ–¹æ³•ï¼Œç”¨äºåŸºå› è¡¨è¾¾æ¨¡å¼è¯†åˆ«ã€å…±è¡¨è¾¾ç½‘ç»œæ„å»ºå’Œç”Ÿç‰©æ ‡å¿—ç‰©å‘ç°ã€‚

### æ ¸å¿ƒç‰¹æ€§

-  **WGCNAåˆ†æ**ï¼šåŠ æƒåŸºå› å…±è¡¨è¾¾ç½‘ç»œåˆ†æ
-  **KNNèšç±»**ï¼šåŸºäºå¯†åº¦çš„æ— ç›‘ç£èšç±»ç»†åŒ–
-  **æ·±åº¦å­¦ä¹ **ï¼š11ç§ç¥ç»ç½‘ç»œæ¨¡å‹
-  **æœºå™¨å­¦ä¹ **ï¼š8ç§ä¼ ç»Ÿæœºå™¨å­¦ä¹ ç®—æ³•
-  **å¯è§†åŒ–**ï¼š30+ç§ä¸“ä¸šçº§ç§‘å­¦å¯è§†åŒ–
-  **æŠ¥å‘Šç”Ÿæˆ**ï¼šè‡ªåŠ¨åŒ–HTMLç»¼åˆåˆ†ææŠ¥å‘Š

---

## ä¸»è¦åŠŸèƒ½

### 1. ç½‘ç»œåˆ†ææ¨¡å—

#### WGCNA (Weighted Gene Co-expression Network Analysis)
```python
# æ ¸å¿ƒåŠŸèƒ½
- è‡ªåŠ¨è½¯é˜ˆå€¼é€‰æ‹©
- æ‹“æ‰‘é‡å çŸ©é˜µ(TOM)è®¡ç®—
- å±‚æ¬¡èšç±»ä¸åŠ¨æ€æ ‘åˆ‡å‰²
- æ¨¡å—è¯†åˆ«ä¸åˆå¹¶
- æ¨¡å—ç‰¹å¾åŸºå› æå–
```

**å…³é”®å‚æ•°ï¼š**
- `--soft_power`: è½¯é˜ˆå€¼å¹‚æ¬¡ï¼ˆ0ä¸ºè‡ªåŠ¨æ£€æµ‹ï¼‰
- `--min_module_size`: æœ€å°æ¨¡å—å¤§å°ï¼ˆé»˜è®¤30ï¼‰
- `--merge_cut_height`: æ¨¡å—åˆå¹¶é˜ˆå€¼ï¼ˆé»˜è®¤0.25ï¼‰
- `--network_type`: ç½‘ç»œç±»å‹ï¼ˆunsigned/signed/signed_hybridï¼‰
- `--deep_split`: æ ‘åˆ‡å‰²æ·±åº¦ï¼ˆ0-3ï¼‰

#### KNNæ— ç›‘ç£èšç±»
```python
# æ ¸å¿ƒåŠŸèƒ½
- å±€éƒ¨å¯†åº¦è®¡ç®—
- å¯†åº¦å³°å€¼è¯†åˆ«
- ç°‡æ‰©å±•ç®—æ³•
- è‡ªé€‚åº”å‚æ•°é€‰æ‹©
```

**å…³é”®å‚æ•°ï¼š**
- `--n_neighbors`: è¿‘é‚»æ•°é‡ï¼ˆé»˜è®¤10ï¼‰
- `--min_cluster_size`: æœ€å°ç°‡å¤§å°ï¼ˆé»˜è®¤5ï¼‰
- `--knn_method`: èšç±»æ–¹æ³•ï¼ˆstandard/adaptiveï¼‰

### 2. æœºå™¨å­¦ä¹ æ¨¡å—

#### æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆ11ä¸ªï¼‰

| æ¨¡å‹ | æ¶æ„ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|
| **RNN** | åŸºç¡€å¾ªç¯ç¥ç»ç½‘ç»œ | æ—¶åºä¾èµ–å»ºæ¨¡ |
| **LSTM** | é•¿çŸ­æœŸè®°å¿†ç½‘ç»œ | é•¿æœŸä¾èµ–æ•è· |
| **BiLSTM** | åŒå‘LSTM | ä¸Šä¸‹æ–‡ä¿¡æ¯åˆ©ç”¨ |
| **GRU** | é—¨æ§å¾ªç¯å•å…ƒ | è½»é‡çº§æ—¶åºå»ºæ¨¡ |
| **CNN** | ä¸€ç»´å·ç§¯ç½‘ç»œ | å±€éƒ¨æ¨¡å¼è¯†åˆ« |
| **ResNet** | æ®‹å·®ç½‘ç»œ | æ·±å±‚ç‰¹å¾å­¦ä¹  |
| **Transformer** | æ³¨æ„åŠ›æœºåˆ¶ | å…¨å±€ä¾èµ–å»ºæ¨¡ |
| **AttentionRNN** | æ³¨æ„åŠ›+RNN | å…³é”®ä½ç½®èšç„¦ |
| **TCN** | æ—¶é—´å·ç§¯ç½‘ç»œ | å› æœåºåˆ—å»ºæ¨¡ |
| **WaveNet** | é—¨æ§å·ç§¯ | åºåˆ—ç”Ÿæˆ |
| **InceptionTime** | å¤šå°ºåº¦å·ç§¯ | å¤šåˆ†è¾¨ç‡ç‰¹å¾ |

#### æœºå™¨å­¦ä¹ æ¨¡å‹ï¼ˆ8ä¸ªï¼‰

| æ¨¡å‹ | ç±»å‹ | ç‰¹ç‚¹ |
|------|------|------|
| **Random Forest** | é›†æˆå­¦ä¹  | å¼ºé²æ£’æ€§ï¼Œç‰¹å¾é‡è¦æ€§ |
| **Gradient Boosting** | é›†æˆå­¦ä¹  | é«˜å‡†ç¡®ç‡ï¼Œé¡ºåºä¼˜åŒ– |
| **AdaBoost** | é›†æˆå­¦ä¹  | è‡ªé€‚åº”æƒé‡è°ƒæ•´ |
| **Extra Trees** | é›†æˆå­¦ä¹  | æåº¦éšæœºåŒ– |
| **SVM** | æ”¯æŒå‘é‡æœº | é«˜ç»´æ•°æ®å¤„ç† |
| **KNN** | å®ä¾‹å­¦ä¹  | ç®€å•ç›´è§‚ |
| **Logistic Regression** | çº¿æ€§æ¨¡å‹ | å¯è§£é‡Šæ€§å¼º |
| **Naive Bayes** | æ¦‚ç‡æ¨¡å‹ | å¿«é€Ÿè®­ç»ƒ |

### 3. å¯è§†åŒ–æ¨¡å—

#### ç½‘ç»œå¯è§†åŒ–
- **åŸºå› ç½‘ç»œå›¾**ï¼šCytoscapeé£æ ¼çš„äº¤äº’ç½‘ç»œ
- **TOMçƒ­å›¾**ï¼šæ‹“æ‰‘é‡å çŸ©é˜µå¯è§†åŒ–
- **æ¨¡å—æ ‘å›¾**ï¼šå±‚æ¬¡èšç±»æ ‘çŠ¶å›¾
- **ç‰¹å¾åŸºå› ç›¸å…³æ€§**ï¼šæ¨¡å—é—´å…³ç³»çƒ­å›¾

#### è¡¨è¾¾æ¨¡å¼å¯è§†åŒ–
- **æ—¶åºåˆ†æå›¾**ï¼šå½©è‰²è¶‹åŠ¿çº¿+ç½®ä¿¡åŒºé—´
- **çƒ­å›¾åˆ†æ**ï¼šåŸå§‹å€¼ã€Z-scoreã€å±‚æ¬¡èšç±»ä¸‰è§†è§’
- **ç®±çº¿å›¾**ï¼šåˆ†ç»„å·®å¼‚+æ˜¾è‘—æ€§æ£€éªŒ
- **é›·è¾¾å›¾**ï¼šæ¨¡å‹æ€§èƒ½å¤šç»´å¯¹æ¯”

#### æ¨¡å‹æ€§èƒ½å¯è§†åŒ–
- **ç¥ç»ç½‘ç»œæ¶æ„å›¾**ï¼šåœ†å½¢èŠ‚ç‚¹å¯è§†åŒ–
- **æ··æ·†çŸ©é˜µ**ï¼šåˆ†ç±»æ€§èƒ½è¯¦è§£
- **å­¦ä¹ æ›²çº¿**ï¼šè®­ç»ƒè¿‡ç¨‹è¿½è¸ª
- **è¿‡æ‹Ÿåˆåˆ†æ**ï¼šè®­ç»ƒé›†vsæµ‹è¯•é›†å¯¹æ¯”
- **PRæƒè¡¡å›¾**ï¼šç²¾ç¡®ç‡-å¬å›ç‡å…³ç³»

---

## ç³»ç»Ÿæ¶æ„

```
Enhanced Gene Expression Analysis System V3.0
â”‚
â”œâ”€â”€ æ•°æ®é¢„å¤„ç†å±‚
â”‚   â”œâ”€â”€ æ•°æ®åŠ è½½ (CSV/TSVè‡ªåŠ¨è¯†åˆ«)
â”‚   â”œâ”€â”€ è´¨é‡æ§åˆ¶ (é›¶è¡¨è¾¾/ä½è¡¨è¾¾/ä½æ–¹å·®è¿‡æ»¤)
â”‚   â”œâ”€â”€ æ ‡å‡†åŒ– (Log2è½¬æ¢, Z-score)
â”‚   â””â”€â”€ åˆ†ç»„æ•´åˆ
â”‚
â”œâ”€â”€ ç½‘ç»œåˆ†æå±‚
â”‚   â”œâ”€â”€ WGCNAæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ è½¯é˜ˆå€¼é€‰æ‹©
â”‚   â”‚   â”œâ”€â”€ é‚»æ¥çŸ©é˜µè®¡ç®—
â”‚   â”‚   â”œâ”€â”€ TOMè®¡ç®—
â”‚   â”‚   â”œâ”€â”€ æ¨¡å—è¯†åˆ«
â”‚   â”‚   â””â”€â”€ ç‰¹å¾åŸºå› æå–
â”‚   â”‚
â”‚   â””â”€â”€ KNNèšç±»æ¨¡å—
â”‚       â”œâ”€â”€ å¯†åº¦è®¡ç®—
â”‚       â”œâ”€â”€ å³°å€¼è¯†åˆ«
â”‚       â””â”€â”€ ç°‡æ‰©å±•
â”‚
â”œâ”€â”€ æœºå™¨å­¦ä¹ å±‚
â”‚   â”œâ”€â”€ æ·±åº¦å­¦ä¹ å¼•æ“ (PyTorch)
â”‚   â”‚   â”œâ”€â”€ æ¨¡å‹æ„å»º
â”‚   â”‚   â”œâ”€â”€ è®­ç»ƒä¼˜åŒ–
â”‚   â”‚   â”œâ”€â”€ æ—©åœæœºåˆ¶
â”‚   â”‚   â””â”€â”€ æ¨¡å‹å¯¼å‡º
â”‚   â”‚
â”‚   â””â”€â”€ ä¼ ç»Ÿæœºå™¨å­¦ä¹  (Scikit-learn)
â”‚       â”œâ”€â”€ é›†æˆå­¦ä¹ 
â”‚       â”œâ”€â”€ æ”¯æŒå‘é‡æœº
â”‚       â””â”€â”€ æ¦‚ç‡æ¨¡å‹
â”‚
â”œâ”€â”€ å¯è§†åŒ–å±‚
â”‚   â”œâ”€â”€ ç½‘ç»œå›¾ (NetworkX + Matplotlib)
â”‚   â”œâ”€â”€ ç»Ÿè®¡å›¾ (Seaborn + Matplotlib)
â”‚   â””â”€â”€ äº¤äº’æŠ¥å‘Š (HTML)
â”‚
â””â”€â”€ è¾“å‡ºç®¡ç†å±‚
    â”œâ”€â”€ ç›®å½•ç»“æ„åˆ›å»º
    â”œâ”€â”€ ç»“æœä¿å­˜ (CSV/JSON/PNG/PDF)
    â””â”€â”€ æŠ¥å‘Šç”Ÿæˆ (HTML)
```

---

## å®‰è£…æŒ‡å—

### ç¯å¢ƒè¦æ±‚

```bash
# Pythonç‰ˆæœ¬
Python >= 3.7

# æ“ä½œç³»ç»Ÿ
Windows / Linux / macOS
```

### ä¾èµ–å®‰è£…

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨requirements.txt

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
conda create -n gene_analysis python=3.9
conda activate gene_analysis

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

**requirements.txt:**
```txt
numpy==1.24.3
pandas==2.0.3
torch==2.0.1
scikit-learn==1.3.0
scipy==1.11.1
matplotlib==3.7.2
seaborn==0.12.2
networkx==3.1
joblib==1.3.1
```

#### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å®‰è£…

```bash
# æ ¸å¿ƒåŒ…
pip install numpy pandas scipy

# æœºå™¨å­¦ä¹ 
pip install torch scikit-learn

# å¯è§†åŒ–
pip install matplotlib seaborn

# å…¶ä»–
pip install networkx joblib
```

### å¯é€‰ä¾èµ–

```bash
# æ›´å¥½çš„Vennå›¾æ”¯æŒ
pip install matplotlib-venn

# GPUæ”¯æŒï¼ˆCUDA 11.8ç¤ºä¾‹ï¼‰
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

### éªŒè¯å®‰è£…

```bash
python gene_analysis.py --help
```

---

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
python gene_analysis.py -i expression.csv -g groups.txt
```

### å®Œæ•´åˆ†æï¼ˆæ¨èï¼‰

```bash
python gene_analysis.py \
    -i expression.csv \
    -g groups.txt \
    --wgcna \
    --soft_power 6 \
    --min_module_size 30 \
    --knn \
    --n_neighbors 10 \
    --epochs 200 \
    --learning_rate 0.001 \
    --export_models
```

### å¿«é€Ÿæµ‹è¯•

```bash
# å°æ•°æ®é›†æµ‹è¯•
python gene_analysis.py \
    -i small_dataset.csv \
    -g groups.txt \
    --epochs 50 \
    --test_size 0.3
```

### é«˜æ€§èƒ½é…ç½®

```bash
# å¤šæ ¸å¹¶è¡Œ + GPUåŠ é€Ÿ
python gene_analysis.py \
    -i large_dataset.csv \
    -g groups.txt \
    --wgcna \
    --knn \
    --n_jobs -1 \
    --batch_size 64
```

---

## è¾“å…¥æ–‡ä»¶æ ¼å¼

### 1. è¡¨è¾¾çŸ©é˜µ (expression.csv)

**æ ¼å¼è¦æ±‚ï¼š**
- è¡Œï¼šåŸºå› 
- åˆ—ï¼šæ ·æœ¬
- ç¬¬ä¸€åˆ—ï¼šåŸºå› ID
- æ•°å€¼ï¼šè¡¨è¾¾é‡ï¼ˆåŸå§‹countsæˆ–æ ‡å‡†åŒ–å€¼ï¼‰

**ç¤ºä¾‹ï¼š**
```csv
Gene_ID,Sample1,Sample2,Sample3,Sample4
Gene_A,100.5,120.3,95.2,110.8
Gene_B,50.2,55.1,48.9,52.3
Gene_C,200.1,210.5,195.3,205.7
...
```

**æ”¯æŒçš„åˆ†éš”ç¬¦ï¼š**
- è‡ªåŠ¨è¯†åˆ«ï¼š`,` `;` `\t` ` `
- æ‰‹åŠ¨æŒ‡å®šï¼š`--sep comma/tab/space`

### 2. åˆ†ç»„æ–‡ä»¶ (groups.txt)

**æ ¼å¼è¦æ±‚ï¼š**
- ä¸¤åˆ—ï¼šSample_ID, Group
- å¿…é¡»åŒ…å«è¡¨å¤´
- æ ·æœ¬IDå¿…é¡»ä¸è¡¨è¾¾çŸ©é˜µåŒ¹é…

**ç¤ºä¾‹ï¼š**
```txt
Sample_ID    Group
Sample1      T0
Sample2      T0
Sample3      T1
Sample4      T1
Sample5      T2
Sample6      T2
```

**æ”¯æŒçš„åˆ†ç»„ç±»å‹ï¼š**
- æ—¶é—´ç‚¹ï¼šT0, T1, T2, ...
- å¤„ç†ç»„ï¼šControl, Treated, ...
- ç”Ÿç‰©æ¡ä»¶ï¼šWT, Mutant, ...
- ä»»æ„æ–‡æœ¬æ ‡ç­¾

---

## è¾“å‡ºç»“æœ

### ç›®å½•ç»“æ„

```
analysis_results_20240101_120000/
â”‚
â”œâ”€â”€ ğŸ“Š wgcna_analysis/                    # WGCNAåˆ†æç»“æœ
â”‚   â”œâ”€â”€ wgcna_soft_threshold.png          # è½¯é˜ˆå€¼é€‰æ‹©å›¾
â”‚   â”œâ”€â”€ wgcna_gene_dendrogram.png         # åŸºå› èšç±»æ ‘
â”‚   â”œâ”€â”€ wgcna_tom_heatmap.png             # TOMçƒ­å›¾
â”‚   â”œâ”€â”€ module_statistics.png             # æ¨¡å—ç»Ÿè®¡
â”‚   â”œâ”€â”€ module_eigengene_correlations.png # ç‰¹å¾åŸºå› ç›¸å…³æ€§
â”‚   â”œâ”€â”€ wgcna_modules.csv                 # æ¨¡å—åˆ†é…è¡¨
â”‚   â””â”€â”€ module_eigengenes.csv             # ç‰¹å¾åŸºå› çŸ©é˜µ
â”‚
â”œâ”€â”€ ğŸ¯ knn_clustering/                    # KNNèšç±»ç»“æœ
â”‚   â”œâ”€â”€ knn_clustering.csv                # èšç±»ç»“æœè¡¨
â”‚   â””â”€â”€ integrated_clustering.csv         # æ•´åˆèšç±»è¡¨
â”‚
â”œâ”€â”€ ğŸ¤– models/                            # æ¨¡å‹ä¸“ç”¨æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ RNN/
â”‚   â”‚   â”œâ”€â”€ RNN_performance.png           # æ€§èƒ½å›¾
â”‚   â”‚   â”œâ”€â”€ RNN_predictions_with_expression.csv
â”‚   â”‚   â””â”€â”€ RNN_summary.json
â”‚   â”œâ”€â”€ LSTM/
â”‚   â”œâ”€â”€ CNN/
â”‚   â””â”€â”€ ... (æ¯ä¸ªæ¨¡å‹ç‹¬ç«‹æ–‡ä»¶å¤¹)
â”‚
â”œâ”€â”€ ğŸ§  neural_network_architectures/      # ç¥ç»ç½‘ç»œæ¶æ„å›¾
â”‚   â”œâ”€â”€ RNN_architecture_circular.png
â”‚   â”œâ”€â”€ LSTM_architecture_circular.png
â”‚   â””â”€â”€ ... (æ‰€æœ‰DLæ¨¡å‹)
â”‚
â”œâ”€â”€ ğŸ“‰ overfitting_analysis/              # è¿‡æ‹Ÿåˆåˆ†æ
â”‚   â”œâ”€â”€ RNN_overfitting_analysis.png
â”‚   â”œâ”€â”€ LSTM_overfitting_analysis.png
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“ˆ time_series_analysis/              # æ—¶åºåˆ†æ
â”‚   â””â”€â”€ time_series_analysis_enhanced.png
â”‚
â”œâ”€â”€ ğŸ“Š boxplot_analysis/                  # ç®±çº¿å›¾åˆ†æ
â”‚   â”œâ”€â”€ RNN_boxplot_analysis.png
â”‚   â”œâ”€â”€ LSTM_boxplot_analysis.png
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ”¥ heatmap_analysis/                  # çƒ­å›¾åˆ†æ
â”‚   â”œâ”€â”€ RNN_heatmap_analysis.png
â”‚   â”œâ”€â”€ LSTM_heatmap_analysis.png
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸŒ networks/                          # åŸºå› ç½‘ç»œ
â”‚   â”œâ”€â”€ gene_network.png                  # ä¸»ç½‘ç»œ
â”‚   â”œâ”€â”€ gene_network.gml                  # Cytoscapeæ ¼å¼
â”‚   â”œâ”€â”€ network_T0.png                    # å„æ—¶é—´ç‚¹ç½‘ç»œ
â”‚   â”œâ”€â”€ network_T1.png
â”‚   â”œâ”€â”€ network_genes_boxplot_significance.png
â”‚   â””â”€â”€ network_statistics.json
â”‚
â”œâ”€â”€ ğŸ“Š visualizations/                    # ç»¼åˆå¯è§†åŒ–
â”‚   â”œâ”€â”€ comprehensive_model_analysis.png  # å››åˆä¸€åˆ†æå›¾
â”‚   â”œâ”€â”€ model_comparison_bars.png         # æ¨¡å‹å¯¹æ¯”
â”‚   â”œâ”€â”€ model_radar_charts.png            # é›·è¾¾å›¾
â”‚   â”œâ”€â”€ precision_recall_tradeoff.png     # PRæ›²çº¿
â”‚   â”œâ”€â”€ expression_pattern_analysis.png   # è¡¨è¾¾æ¨¡å¼
â”‚   â”œâ”€â”€ cluster_centers_heatmap.png       # èšç±»ä¸­å¿ƒ
â”‚   â””â”€â”€ key_genes_patterns.png            # å…³é”®åŸºå› æ¨¡å¼
â”‚
â”œâ”€â”€ ğŸ” intersection_analysis/             # äº¤é›†åˆ†æ
â”‚   â”œâ”€â”€ models_venn_diagram.png           # Vennå›¾
â”‚   â”œâ”€â”€ gene_overlap_analysis.png         # é‡å åˆ†æ
â”‚   â””â”€â”€ intersection_genes.csv            # äº¤é›†åŸºå› åˆ—è¡¨
â”‚
â”œâ”€â”€ ğŸ’¾ data/                              # æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ group_means.csv                   # ç»„å‡å€¼
â”‚   â”œâ”€â”€ gene_clusters.csv                 # åŸºå› èšç±»
â”‚   â”œâ”€â”€ key_genes.csv                     # å…³é”®åŸºå› 
â”‚   â”œâ”€â”€ model_performance.csv             # æ¨¡å‹æ€§èƒ½è¡¨
â”‚   â”œâ”€â”€ model_results.json                # ç»“æœJSON
â”‚   â”œâ”€â”€ preprocessing_stats.json          # é¢„å¤„ç†ç»Ÿè®¡
â”‚   â”œâ”€â”€ intersection_genes.csv            # äº¤é›†åŸºå› 
â”‚   â””â”€â”€ {Model}_predictions.csv           # å„æ¨¡å‹é¢„æµ‹
â”‚
â”œâ”€â”€ ğŸ“ reports/                           # æŠ¥å‘Šæ–‡ä»¶
â”‚   â”œâ”€â”€ comprehensive_analysis_report.html # HTMLæŠ¥å‘Š
â”‚   â””â”€â”€ analysis_summary.json             # æ‘˜è¦JSON
â”‚
â”œâ”€â”€ ğŸ’¼ exported_models/                   # å¯¼å‡ºçš„æ¨¡å‹
â”‚   â”œâ”€â”€ RNN/
â”‚   â”‚   â””â”€â”€ RNN_model.pth
â”‚   â”œâ”€â”€ LSTM/
â”‚   â”‚   â””â”€â”€ LSTM_model.pth
â”‚   â”œâ”€â”€ RandomForest/
â”‚   â”‚   â””â”€â”€ RandomForest_model.joblib
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ directory_structure.json              # ç›®å½•ç»“æ„ç´¢å¼•
```

### å…³é”®è¾“å‡ºæ–‡ä»¶è¯´æ˜

#### 1. æ¨¡å—åˆ†é…æ–‡ä»¶ (wgcna_modules.csv)
```csv
Gene,Module
Gene_A,turquoise
Gene_B,blue
Gene_C,brown
...
```

#### 2. æ¨¡å‹æ€§èƒ½è¡¨ (model_performance.csv)
```csv
Model,Accuracy,Precision,Recall,F1,Training_Time
LSTM,0.9234,0.9156,0.9234,0.9189,45.23
CNN,0.9123,0.9045,0.9123,0.9078,32.15
...
```

#### 3. å…³é”®åŸºå› åˆ—è¡¨ (key_genes.csv)
```csv
gene,pattern,slope,r_squared,max_change,cv,score,cluster
Gene_X,Strong_Increasing,1.234,0.89,2.5,0.15,25.6,1
Gene_Y,Peak,0.345,0.76,3.2,0.22,18.9,2
...
```

#### 4. é¢„æµ‹ç»“æœ (predictions_with_expression.csv)
```csv
gene,true_label,predicted_label,correct,true_pattern,predicted_pattern,expr_Sample1,...
Gene_A,0,0,True,Increasing,Increasing,100.5,...
Gene_B,2,2,True,Peak,Peak,200.1,...
...
```

---

## å‚æ•°è¯¦è§£

### å¿…éœ€å‚æ•°

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `-i, --input` | å­—ç¬¦ä¸² | è¡¨è¾¾çŸ©é˜µæ–‡ä»¶è·¯å¾„ |
| `-g, --groups` | å­—ç¬¦ä¸² | åˆ†ç»„æ–‡ä»¶è·¯å¾„ |

### WGCNAå‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--wgcna` | æ ‡å¿— | False | å¯ç”¨WGCNAåˆ†æ |
| `--soft_power` | æ•´æ•° | 0 | è½¯é˜ˆå€¼å¹‚æ¬¡ï¼ˆ0=è‡ªåŠ¨ï¼‰ |
| `--min_module_size` | æ•´æ•° | 30 | æœ€å°æ¨¡å—å¤§å° |
| `--merge_cut_height` | æµ®ç‚¹ | 0.25 | æ¨¡å—åˆå¹¶é˜ˆå€¼ |
| `--network_type` | é€‰æ‹© | unsigned | ç½‘ç»œç±»å‹ |
| `--deep_split` | æ•´æ•° | 2 | æ ‘åˆ‡å‰²æ·±åº¦(0-3) |

### KNNå‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--knn` | æ ‡å¿— | False | å¯ç”¨KNNèšç±» |
| `--n_neighbors` | æ•´æ•° | 10 | è¿‘é‚»æ•°é‡ |
| `--min_cluster_size` | æ•´æ•° | 5 | æœ€å°ç°‡å¤§å° |
| `--knn_method` | é€‰æ‹© | standard | èšç±»æ–¹æ³• |

### æ·±åº¦å­¦ä¹ å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--epochs` | æ•´æ•° | 100 | è®­ç»ƒè½®æ•° |
| `--learning_rate` | æµ®ç‚¹ | 0.001 | å­¦ä¹ ç‡ |
| `--batch_size` | æ•´æ•° | 32 | æ‰¹é‡å¤§å° |
| `--hidden_size` | æ•´æ•° | 64 | éšè—å±‚å¤§å° |
| `--dropout` | æµ®ç‚¹ | 0.3 | Dropoutç‡ |
| `--num_layers` | æ•´æ•° | 2 | RNNå±‚æ•° |
| `--patience` | æ•´æ•° | 20 | æ—©åœè€å¿ƒå€¼ |

### å…¶ä»–å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--test_size` | æµ®ç‚¹ | 0.2 | æµ‹è¯•é›†æ¯”ä¾‹ |
| `--val_size` | æµ®ç‚¹ | 0.2 | éªŒè¯é›†æ¯”ä¾‹ |
| `--n_clusters` | æ•´æ•° | 6 | K-meansèšç±»æ•° |
| `--output_prefix` | å­—ç¬¦ä¸² | analysis | è¾“å‡ºå‰ç¼€ |
| `--export_models` | å¸ƒå°” | True | å¯¼å‡ºæ¨¡å‹ |
| `--n_jobs` | æ•´æ•° | -1 | å¹¶è¡Œä½œä¸šæ•° |

---

## åˆ†ææµç¨‹

### å®Œæ•´æµç¨‹å›¾

```mermaid
graph TD
    A[å¼€å§‹] --> B[æ•°æ®åŠ è½½]
    B --> C[æ•°æ®é¢„å¤„ç†]
    C --> D{å¯ç”¨WGCNA?}
    D -->|æ˜¯| E[WGCNAåˆ†æ]
    D -->|å¦| F[è·³è¿‡]
    E --> G{å¯ç”¨KNN?}
    F --> G
    G -->|æ˜¯| H[KNNèšç±»]
    G -->|å¦| I[å‡†å¤‡MLæ•°æ®]
    H --> I
    I --> J[æ·±åº¦å­¦ä¹ è®­ç»ƒ]
    I --> K[æœºå™¨å­¦ä¹ è®­ç»ƒ]
    J --> L[æ¨¡å‹è¯„ä¼°]
    K --> L
    L --> M[ç”Ÿæˆå¯è§†åŒ–]
    M --> N[ä¿å­˜ç»“æœ]
    N --> O[ç”ŸæˆæŠ¥å‘Š]
    O --> P[ç»“æŸ]
```

### è¯¦ç»†æ­¥éª¤

#### Step 1: æ•°æ®åŠ è½½ä¸é¢„å¤„ç†
1. **æ–‡ä»¶è¯»å–**
   - è‡ªåŠ¨æ£€æµ‹åˆ†éš”ç¬¦
   - éªŒè¯æ–‡ä»¶æ ¼å¼
   - åŠ è½½è¡¨è¾¾çŸ©é˜µå’Œåˆ†ç»„ä¿¡æ¯

2. **è´¨é‡æ§åˆ¶**
   - ç§»é™¤é›¶è¡¨è¾¾åŸºå› 
   - è¿‡æ»¤ä½è¡¨è¾¾åŸºå› ï¼ˆ< 3ä¸ªæ ·æœ¬è¡¨è¾¾ > é˜ˆå€¼ï¼‰
   - è¿‡æ»¤ä½æ–¹å·®åŸºå› ï¼ˆ< 10%åˆ†ä½æ•°ï¼‰

3. **æ ‡å‡†åŒ–**
   - Log2è½¬æ¢ï¼ˆå¦‚æœéœ€è¦ï¼‰
   - æ ·æœ¬-åˆ†ç»„åŒ¹é…
   - è®¡ç®—ç»„å‡å€¼å’Œæ ‡å‡†å·®

#### Step 2: WGCNAåˆ†æ
1. **è½¯é˜ˆå€¼é€‰æ‹©**
   ```python
   # è‡ªåŠ¨é€‰æ‹©æœ€ä½³å¹‚æ¬¡
   # ç›®æ ‡ï¼šRÂ² > 0.85
   # èŒƒå›´ï¼š1-20
   ```

2. **ç½‘ç»œæ„å»º**
   - è®¡ç®—é‚»æ¥çŸ©é˜µ
   - è®¡ç®—TOMçŸ©é˜µ
   - å±‚æ¬¡èšç±»

3. **æ¨¡å—è¯†åˆ«**
   - åŠ¨æ€æ ‘åˆ‡å‰²
   - æ¨¡å—åˆå¹¶
   - ç‰¹å¾åŸºå› æå–

#### Step 3: KNNèšç±»
1. **å¯†åº¦è®¡ç®—**
   ```python
   density = 1 / (mean_knn_distance + epsilon)
   ```

2. **å³°å€¼è¯†åˆ«**
   - å¯»æ‰¾å±€éƒ¨å¯†åº¦æœ€å¤§å€¼
   - å¯†åº¦é˜ˆå€¼è¿‡æ»¤

3. **ç°‡æ‰©å±•**
   - åŸºäºå¯†åº¦å¯è¾¾æ€§
   - è€ƒè™‘ç§å­å¯†åº¦æ¯”ä¾‹

#### Step 4: æœºå™¨å­¦ä¹ 
1. **æ•°æ®å‡†å¤‡**
   - ç‰¹å¾æå–ï¼ˆç»„å‡å€¼ï¼‰
   - æ ‡ç­¾ç”Ÿæˆï¼ˆæ¨¡å¼åˆ†ç±»ï¼‰
   - æ•°æ®åˆ’åˆ†ï¼ˆè®­ç»ƒ/éªŒè¯/æµ‹è¯•ï¼‰

2. **æ·±åº¦å­¦ä¹ è®­ç»ƒ**
   - 11ä¸ªæ¨¡å‹å¹¶è¡Œè®­ç»ƒ
   - æ—©åœæœºåˆ¶
   - å­¦ä¹ ç‡è°ƒåº¦
   - æ¨¡å‹éªŒè¯

3. **ä¼ ç»Ÿæœºå™¨å­¦ä¹ **
   - 8ä¸ªç®—æ³•è®­ç»ƒ
   - äº¤å‰éªŒè¯ï¼ˆå¯é€‰ï¼‰
   - è¶…å‚æ•°ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

#### Step 5: è¯„ä¼°ä¸å¯è§†åŒ–
1. **æ€§èƒ½è¯„ä¼°**
   - å‡†ç¡®ç‡ã€ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1
   - æ··æ·†çŸ©é˜µ
   - è®­ç»ƒæ—¶é—´

2. **å¯è§†åŒ–ç”Ÿæˆ**
   - 30+ç§å›¾è¡¨
   - PDF + PNGæ ¼å¼
   - é«˜åˆ†è¾¨ç‡è¾“å‡º

3. **æŠ¥å‘Šç”Ÿæˆ**
   - HTMLç»¼åˆæŠ¥å‘Š
   - JSONæ•°æ®æ‘˜è¦
   - CSVç»“æœè¡¨æ ¼

---


## å¸¸è§é—®é¢˜

### Q1: å†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ

**é—®é¢˜ï¼š** åˆ†æå¤§å‹æ•°æ®é›†æ—¶å†…å­˜æº¢å‡º

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. å¢åŠ è™šæ‹Ÿå†…å­˜
# 2. åˆ†æ‰¹å¤„ç†
# 3. å‡å°‘æ¨¡å—å¤§å°
python gene_analysis.py \
    -i large_data.csv \
    -g groups.txt \
    --min_module_size 50 \  # å¢å¤§æœ€å°æ¨¡å—
    --batch_size 16         # å‡å°æ‰¹é‡å¤§å°
```

### Q2: WGCNAæ‰¾ä¸åˆ°åˆé€‚çš„è½¯é˜ˆå€¼ï¼Ÿ

**é—®é¢˜ï¼š** RÂ²å§‹ç»ˆä½äº0.85

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ‰‹åŠ¨æŒ‡å®šå¹‚æ¬¡
--soft_power 12

# 2. é™ä½RÂ²é˜ˆå€¼ï¼ˆåœ¨ä»£ç ä¸­ä¿®æ”¹RsquaredCutï¼‰

# 3. ä½¿ç”¨signedç½‘ç»œ
--network_type signed
```

### Q3: æ¨¡å‹è®­ç»ƒå¤ªæ…¢ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. å‡å°‘è®­ç»ƒè½®æ•°
--epochs 50

# 2. å¯ç”¨GPU
# è‡ªåŠ¨æ£€æµ‹ï¼Œæ— éœ€è®¾ç½®

# 3. å‡å°‘æ¨¡å‹æ•°é‡
# æ³¨é‡Šæ‰ä¸éœ€è¦çš„æ¨¡å‹ï¼ˆåœ¨ä»£ç ä¸­ï¼‰

# 4. å¹¶è¡Œè®¡ç®—
--n_jobs -1
```

### Q4: æ‰¾ä¸åˆ°å…±åŒæ ·æœ¬ï¼Ÿ

**é—®é¢˜ï¼š** "No matching samples between expression data and group file"

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ£€æŸ¥æ ·æœ¬åæ ¼å¼
# è¡¨è¾¾çŸ©é˜µåˆ—åå¿…é¡»ä¸åˆ†ç»„æ–‡ä»¶Sample_IDå®Œå…¨ä¸€è‡´

# 2. å»é™¤ç©ºæ ¼
sed 's/ //g' groups.txt > groups_clean.txt

# 3. ç»Ÿä¸€å¤§å°å†™
```

### Q5: å¯è§†åŒ–å›¾è¡¨ä¸æ˜¾ç¤ºä¸­æ–‡ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼š**
```python
# åœ¨ä»£ç å¼€å¤´æ·»åŠ ï¼š
import matplotlib.pyplot as plt
plt.rcParams['font.sans-serif'] = ['SimHei']  # Windows
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS']  # macOS
```

### Q6: GPUæœªè¢«ä½¿ç”¨ï¼Ÿ

**æ£€æŸ¥ï¼š**
```python
import torch
print(torch.cuda.is_available())  # åº”è¿”å›True
print(torch.cuda.get_device_name(0))  # æ˜¾ç¤ºGPUåç§°
```

**å®‰è£…CUDAç‰ˆPyTorchï¼š**
```bash
# CUDA 11.8
pip install torch --index-url https://download.pytorch.org/whl/cu118

# CUDA 12.1
pip install torch --index-url https://download.pytorch.org/whl/cu121
```

---

## é«˜çº§ç”¨æ³•

### 1. è‡ªå®šä¹‰æ¨¡å‹

```python
# åœ¨ä»£ç ä¸­æ·»åŠ æ–°æ¨¡å‹
class CustomModel(nn.Module):
    def __init__(self, input_size, num_classes=4):
        super(CustomModel, self).__init__()
        # å®šä¹‰å±‚
        self.fc1 = nn.Linear(input_size, 128)
        self.fc2 = nn.Linear(128, num_classes)
    
    def forward(self, x):
        x = torch.relu(self.fc1(x))
        return self.fc2(x)

# æ·»åŠ åˆ°æ¨¡å‹å­—å…¸
dl_models['Custom'] = CustomModel(input_size=n_features)
```

### 2. æ‰¹é‡åˆ†æ

```bash
#!/bin/bash
# batch_analysis.sh

for dataset in data/*.csv; do
    python gene_analysis.py \
        -i "$dataset" \
        -g "${dataset%.csv}_groups.txt" \
        --wgcna --knn \
        --output_prefix "$(basename $dataset .csv)"
done
```

### 3. å‚æ•°ç½‘æ ¼æœç´¢

```python
# ä¿®æ”¹ä»£ç å¯ç”¨ç½‘æ ¼æœç´¢
--grid_search  # ä¼ é€’å‚æ•°

# åœ¨ä»£ç ä¸­å®šä¹‰å‚æ•°ç½‘æ ¼
param_grid = {
    'n_estimators': [50, 100, 200],
    'max_depth': [5, 10, 15],
    'min_samples_split': [2, 5, 10]
}
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç¡¬ä»¶é…ç½®

| ç»„ä»¶ | æœ€ä½é…ç½® | æ¨èé…ç½® | å¤§æ•°æ®é…ç½® |
|------|---------|---------|-----------|
| CPU | 4æ ¸å¿ƒ | 8æ ¸å¿ƒ | 16æ ¸å¿ƒ+ |
| RAM | 8GB | 16GB | 32GB+ |
| GPU | æ—  | GTX 1060 | RTX 3090 |
| å­˜å‚¨ | HDD | SSD | NVMe SSD |

### æ•°æ®è§„æ¨¡æŒ‡å—

| åŸºå› æ•° | æ ·æœ¬æ•° | é¢„è®¡æ—¶é—´ | æ¨èé…ç½® |
|--------|--------|---------|---------|
| < 5,000 | < 50 | 10-30åˆ†é’Ÿ | æœ€ä½é…ç½® |
| 5,000-10,000 | 50-100 | 30åˆ†é’Ÿ-2å°æ—¶ | æ¨èé…ç½® |
| 10,000-20,000 | 100-200 | 2-6å°æ—¶ | å¤§æ•°æ®é…ç½® |
| > 20,000 | > 200 | 6å°æ—¶+ | æœåŠ¡å™¨é…ç½® |

---


